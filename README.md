<img width="1696" height="1253" alt="Screenshot 2025-12-05 142808" src="https://github.com/user-attachments/assets/f8918134-26b0-4a66-a83f-8a12810de770" /># TextThreat SIEM Proof-of-Concept

This repository contains the PoC implementation for **TextThreat** – an AI-powered toxicity / cyberbullying / stress signal detector on social media text.

The PoC:

- Fine-tunes **DistilBERT** on the **Jigsaw Toxic Comment** dataset.
- Generates **ECS / IDS-style JSON events** from model predictions.
- Exports events as **NDJSON** for ingestion into a **SIEM** (e.g., Splunk).
- Provides the core pieces you need for:
  - Detection (ML model)
  - Normalization (event schema)
  - SIEM analytics (dashboards, alerts)

> All experiments and pipelines are implemented in a **single notebook**:  
> `notebooks/textthreat_poc.ipynb`.

---

## 1. Project Structure

Expected layout:

```text
textthreat-poc/
├── .venv/                          # Python virtual environment (per machine, not committed)
├── LICENSE                         # optional
├── README.md
├── requirements.txt
│
├── data/
│   ├── jigsaw/
│   │   ├── train.csv               # Jigsaw Toxic Comment dataset (required)
│   │   ├── test.csv                # optional
│   │   ├── test_labels.csv         # optional
│   │   └── sample_submission.csv   # optional
│   ├── dreaddit/
│   │   ├── dreaddit-train.csv      # optional (for future extensions)
│   │   └── dreaddit-test.csv       # optional
│   └── exports/
│       └── textthreat_events.ndjson   # ECS-style events generated by the notebook
│
├── models/
│   └── distilbert_jigsaw/          # fine-tuned model + tokenizer + metrics
│       ├── config.json
│       ├── pytorch_model.bin
│       ├── tokenizer.json
│       ├── vocab.txt
│       └── metrics.json
│
└── notebooks/
    └── textthreat_poc.ipynb        # main PoC notebook (all steps live here)
```

---

## 2. Prerequisites

- **Python** 3.9+ (3.10 / 3.11 also OK)
- **VS Code** (recommended for notebooks)
- **Git** (if cloning from a remote repo)
- Jigsaw Toxic Comment dataset (`train.csv`) downloaded from Kaggle.

---

## 3. Clone or Open the Project

If using Git:

```bash
cd /path/where/you/want/the/project
git clone <REPO_URL> textthreat-poc
cd textthreat-poc
```

If you already have the folder, just:

```bash
cd /path/to/textthreat-poc
```

---

## 4. Create & Activate a Virtual Environment

> Do this once per machine (Mac, Windows, lab VM, etc.).

### macOS / Linux

```bash
cd /path/to/textthreat-poc

python3 -m venv .venv
source .venv/bin/activate
```

### Windows (PowerShell)

```powershell
cd C:\path\to\textthreat-poc

python -m venv .venv
.venv\Scripts\Activate.ps1
```

You should see `(.venv)` at the beginning of your terminal prompt, indicating the venv is active.

---

## 5. Install Dependencies from `requirements.txt`

With the virtual environment **activated**:

```bash
pip install --upgrade pip
pip install -r requirements.txt
```

Recommended `requirements.txt` content:

```text
torch
transformers
datasets
scikit-learn
accelerate
pandas
numpy
matplotlib
ipykernel
```

You can pin exact versions later if you need reproducibility across machines.

---

## 6. Register the Virtual Environment as a Jupyter Kernel

Still inside the **activated** venv:

```bash
python -m ipykernel install --user --name=textthreat-poc-venv
```

This registers the venv as a kernel you can pick in VS Code’s notebook UI.

---

## 7. Dataset Setup

Place the Jigsaw dataset here:

```text
textthreat-poc/data/jigsaw/train.csv
```

Optional (for future work):

```text
textthreat-poc/data/dreaddit/dreaddit-train.csv
textthreat-poc/data/dreaddit/dreaddit-test.csv
```

---

## 8. Open and Configure the Notebook in VS Code

1. Open **VS Code**.
2. Go to **File → Open Folder…** and select `textthreat-poc`.
3. In the Explorer, open:  
   `notebooks/textthreat_poc.ipynb`

### Select the Correct Kernel

At the top-right of the notebook:

1. Click the kernel name (e.g., `Python 3.x`, `Python Environments`).
2. Choose:

   - `textthreat-poc-venv`  
   **or**
   - The interpreter whose path points to `.venv` inside this project.

To verify, run this in a new cell:

```python
import sys, pandas as pd
print("Python executable:", sys.executable)
print("Pandas version:", pd.__version__)
```

If `sys.executable` points to your project’s `.venv` and you see a pandas version printed (no error), the kernel is correctly configured.

---

## 9. Running the PoC Notebook

The main notebook `notebooks/textthreat_poc.ipynb` is organized into logical sections, for example:

1. **Setup & Imports**  
2. **Load Jigsaw & Dreaddit + EDA**  
3. **Prepare Jigsaw Dataset for Training**  
4. **Train DistilBERT (1 epoch, PoC)**  
5. **Save Model & Metrics**  
6. **Generate ECS-Style Events (NDJSON)**  
7. **Preview Exported Events**

> Always run cells **top to bottom**, especially after restarting the kernel, so that variables and model objects are defined correctly.

After running all sections:

- The fine-tuned model and `metrics.json` will be saved under:

  ```text
  models/distilbert_jigsaw/
  ```

- ECS-style, SIEM-ready events will be saved to:

  ```text
  data/exports/textthreat_events.ndjson
  ```

This NDJSON file is what you will ingest into Splunk (or another SIEM).

---

## 10. Quick Recap (New Machine Setup)

On **any new machine** (Mac, Windows, or VM):

```bash
# 1. Get the project
git clone <REPO_URL> textthreat-poc
cd textthreat-poc

# 2. Create + activate virtual environment
python3 -m venv .venv                # or: python -m venv .venv (Windows)
source .venv/bin/activate            # or: .venv\Scripts\Activate.ps1

# 3. Install dependencies
pip install --upgrade pip
pip install -r requirements.txt

# 4. Register Jupyter kernel (once)
python -m ipykernel install --user --name=textthreat-poc-venv

# 5. Open notebooks/textthreat_poc.ipynb in VS Code
#    Select 'textthreat-poc-venv' as kernel
#    Run cells from top to bottom.
```

---

## 11. Next Steps (SIEM / Splunk)

Once `data/exports/textthreat_events.ndjson` is generated:

1. **Ingest** it into Splunk as a JSON/NDJSON data source (index: `textthreat`).
2. Build dashboards to visualize:
   - `textthreat.severity_level`
   - `textthreat.labels`
   - `event.severity` over time
3. Configure a **SOAR-lite email alert** for high severity events, e.g.:

   - Search: `index=textthreat event.severity > 0.8`
   - Trigger: when results > 0
   - Action: send email with comment text, labels, and severity.
  
Demo Example:
1. SIEM Dashboard
  <img width="1696" height="1253" alt="Screenshot 2025-12-05 142808" src="https://github.com/user-attachments/assets/df5b646b-40bd-4c07-92e2-2a9f19677af6" />

2. SOAR-lite Alerts 
  <img width="1709" height="453" alt="Screenshot 2025-12-05 143421" src="https://github.com/user-attachments/assets/760ce9f3-56d5-4171-82e3-3b56239dcb4a" />

These steps complete the end-to-end PoC: **model → normalized events → SIEM → alerting**.
